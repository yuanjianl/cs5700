


In DNS Server and each of the replicas, there are two process running. In DNS Server,
dns.py and map.py is running. dns.py is handling all DNS request, map.py is the one
that has the information of which replica is the best for a given client ip. In 
Replica server, httpserver.py is handling all http request, and pinger.py periodically
pings the clients and pass the information to map.py in DNS server.

The CDN architecture is drawed as the following. It also has the work flow of the CDN
including the client requests.

The diagram is an ascii art. Please open it with the width of editor set to at least
90
-------------------------------------------------------------------------------------
|             DNS Server                  ||                 REPLICAS              |
|      dns.py      |        map.py        ||      pinger.py       |  httpserver.py |
|  ^  |      (2) Best replica             ||                      | |    ^  |   ^  |
|  |  |     -------------->               ||                      | | (7)|  |(6)|  |
|  |  |       for client A        (a) List clients    |---------| | |    |  |   |  |
|  |  |            |             <--------------------| Measure | | |    |  |   |  |
|  |  |            |                      ||          |  every  | | |    |  |   |  |
|  |  |            |              (b) OK, Client List |    2    | | |    | \|/  |  |
|  |  |      (3) Replica IP      -------------------->| seconds | | | |-------| |  |
|  |  |     <--------------               ||          |---------| | | | cache | |  |
|  |  |            |                      ||             ^   |    | | |  or   | |  |
|  |  |            |                      ||             |   |    | | |origin | |  |
|  |  |            |                      ||             |   |    | | |-------| |  |
|  |  |            |              (e) Measuremnt         |   |    | |           |  |
|  |  |            |             <-------------------    |   |    | |           |  |
|  |  |            |                   Result            |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |             (f)      OK             |   |    | |           |  |
|  |  |            |             ------------------>     |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||             |   |    | |           |  |
|  |  |            |                      ||   (d) RTT   |   |    | |           |  |
|  |  |                                  -----------------   |      |           |  | 
|  |  |                                  |      (c) ping     |      |           |  | 
|  |  |                                  |  -----------------|      |           |  | 
|  |  |(4) DNS Response                  |  |  (8) content          |           |  | 
|  |  |--------------------------------- |  | ----------------------|           |  |  
|  |                                   | | \|/|                                 |  |
|  |  (1) DNS Request                 \|/    \|/   (5) wget content from        |  | 
|   ---------------------------------  Client A---------------------------------   |
|                                                            Replica               |
|                                                                                  |
|----------------------------------------------------------------------------------|


Measurement:
We are using the active measument. Once a client has sent a DNS request to DNS server,
 the map.py will remember the ip of the client. Periodically, pinger.py in each 
replica server would get the current client list from map.py, ping each of them to 
get RTT, then sending it back. In map.py, if the new RTT is smaller than current,
 map the client to the new Replica. The reason we put the map.py to DNS server is
that we try to take advantage of no memory limit on DNS server. In replicas, we are
trying to cache as much as possible ( lesss than 10MB limit of course ).

Cache:
We are using the LFU cache replacement strategy. And we also did a small trick to 
speedup the server response: in deployCDN, we put a script to secretely download 
all potential contents. In this way, once the clients start to request, there 
already are some pages there.


